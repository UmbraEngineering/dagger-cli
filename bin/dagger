#!/usr/bin/env node

var tabtab = require('tabtab');

// Handle bash completion
if (process.argv[2] === 'completion') {
	// Patch for path.exists because tabtab has not updated
	require('exists-patch').patchBackward();

	return tabtab.complete('dagger', function(err, data) {
		if (err || ! data) {
			return;
		}

		if (/^--\w?/.test(data.last)) {
			return tabtab.log(['help', 'version'], data, '--');
		}

		if (/^-\w?/.test(data.last)) {
			return tabtab.log(['h', 'V'], data, '-');
		}

		if (data.words === 2) {
			// 
		}

		tabtab.log(['init', 'create', 'destroy', 'completion'], data);
	});
}

// -------------------------------------------------------------

var program = require('commander');

program
	.version('0.0.1')
	.command('init', 'initialize a new dagger application')
	.command('create <type> <name>', 'create a new resource')
	.command('destroy <type> <name>', 'destroy and existing resource')
	.parse(process.argv);
